<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Regina Safety Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f6f9;
    }
    h2 {
      text-align: center;
      margin: 20px 0;
      font-size: 45px;
      color: #676c70fc;
      text-shadow: 1px 2px 9px #fcfcfc5c;
      background-color: #f0f8ffb5;
    }
    .container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
      margin-bottom: 20px;
    }
    .box {
      flex: 1;
      min-width: 300px;
      padding: 10px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    iframe {
      width: 100%;
      height: 480px;
      border: none;
      border-radius: 8px;
    }
    #map {
      height: 500px;
      width: 100%;
      border-radius: 8px;
    }
    .btn {
      background-color: #0069d9;
      color: white;
      border-radius: 5px;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .btn:hover {
      background-color: #0056b3;
    }
    .box {
      background-color: #25242447;
    }
    /* Chatbot styles */
    #chatbot {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 350px;
      height: 500px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      display: none; /* Initially hidden */
      z-index: 1000;
      overflow-y: auto;
      padding: 20px;
    }
    #chatbotHeader {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: bold;
    }
    #chatbotMessages {
      max-height: 380px;
      overflow-y: auto;
      margin-bottom: 10px;
    }
    .message {
      margin: 10px 0;
    }
    .message.bot {
      color: #333;
    }
    .message.user {
      color: #0069d9;
      text-align: right;
    }
    #chatbotInput {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      margin-top: 10px;
    }
    #openChatbot {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #0069d9;
      color: white;
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 24px;
      display: block;
      cursor: pointer;
      z-index: 1000;
    }
  </style>
</head>
<body>
  <h2>Regina Safety Map</h2>
  <div class="container">
    <div class="box">
      <div id="map"></div>
    </div>
    <div class="box">
      <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSdWj35cPdCx9fsBj20PNxGfaxRc2J1waQrvF0oV_KjrPrarUg/viewform?embedded=true">Loadingâ€¦</iframe>
    </div>
  </div>

  <!-- Chatbot UI -->
  <div id="chatbot">
    <div id="chatbotHeader">
      <span>Chat with Us</span>
      <button onclick="toggleChatbot()">X</button>
    </div>
    <div id="chatbotMessages"></div>
    <input type="text" id="chatbotInput" placeholder="Ask me anything..." onkeydown="handleUserInput(event)" />
  </div>
  <button id="openChatbot" onclick="toggleChatbot()">ðŸ’¬</button>

  <script>
    // Toggle chatbot visibility
    function toggleChatbot() {
      const chatbot = document.getElementById("chatbot");
      chatbot.style.display = chatbot.style.display === "none" || chatbot.style.display === "" ? "block" : "none";
    }

    // Handle user input in chatbot
    function handleUserInput(event) {
      if (event.key === 'Enter' && event.target.value.trim() !== "") {
        const userMessage = event.target.value.trim();
        addMessage(userMessage, "user");

        // Respond to user
        respondToUser(userMessage);
        
        // Clear input field
        event.target.value = "";
      }
    }

    // Add message to the chat window
    function addMessage(message, sender) {
      const messagesContainer = document.getElementById("chatbotMessages");
      const messageElement = document.createElement("div");
      messageElement.classList.add("message", sender);
      messageElement.textContent = message;
      messagesContainer.appendChild(messageElement);
      messagesContainer.scrollTop = messagesContainer.scrollHeight; // Scroll to bottom
    }

    // Predefined bot responses
    function respondToUser(userMessage) {
  let response = "";
  
  // Simple keyword-based responses
  if (userMessage.toLowerCase().includes("safety")) {
    response = "You can view safety reports on this map and get information about safety conditions in Regina.";
  } else if (userMessage.toLowerCase().includes("location")) {
    response = "Please provide a location, and I will try to find its coordinates for you.";
  } else if (userMessage.toLowerCase().includes("indigenous")) {
    response = "We have various Indigenous historical sites, such as the Treaty 4 Governance Centre.";
  } else if (userMessage.toLowerCase().includes("how are you") || userMessage.toLowerCase().includes("how are u")) {
    response = "I'm doing great, thank you for asking! How can I assist you today?";
  } else {
    response = "I'm sorry, I didn't quite get that. Can you ask something else?";
  }

  // Add bot response to chat
  addMessage(response, "bot");
}


    // Initialize map
    const map = L.map('map').setView([50.4454, -104.6185], 12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Example markers
    const indigenousSites = [
      { name: "Treaty 4 Governance Centre", lat: 50.6506, lng: -104.6453, description: "A center dedicated to Treaty 4 governance and history.", link: "https://www.treaty4.ca/" },
      { name: "First Nations University of Canada", lat: 50.4309, lng: -104.6174, description: "Offers Indigenous-focused education and cultural events.", link: "https://www.fnuniv.ca/" },
      { name: "Royal Saskatchewan Museum", lat: 50.4418, lng: -104.6066, description: "Features Indigenous exhibits and history of the land.", link: "https://royalsaskmuseum.ca/" }
    ];

    // Add historical markers
    indigenousSites.forEach(site => {
      var marker = L.marker([site.lat, site.lng]).addTo(map);
      marker.bindPopup(`<b>${site.name}</b><br>${site.description}<br><a href="${site.link}" target="_blank">Learn More</a>`);
    });
  </script>

  <!-- Bootstrap JS (Optional) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
